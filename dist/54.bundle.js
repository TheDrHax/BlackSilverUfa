"use strict";(self.webpackChunkblacksilverufa=self.webpackChunkblacksilverufa||[]).push([[54],{87054:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Nt}),r(74916),r(64765),r(66992),r(41539),r(78783),r(33948),r(41637),r(4723),r(92222),r(15306),r(21249),r(57327),r(69600),r(68309),r(23157),r(30489),r(81299),r(12419),r(21703),r(47941),r(82526),r(38880),r(54747),r(49337),r(41817),r(32165),r(47042),r(91038),r(77601);var n=r(67294),a=r(73935),o=r(34051),l=r(31555),i=r(84883),c=r(77104),s=r(69832),u=r(43489),f=r(16714),m=r(85509),d=r(17905),p=r(10928),y=r.n(p),v=r(70405),h=r(73727),b=r(39244),g=r.n(b),E=r(1852),O=r.n(E),w=r(57371),S=r(51436),j=r(51417),k=r(10986),P=r(30898),x=(r(88674),r(69826),r(19601),r(45697)),Z=r.n(x),R=r(36968),N=(r(48702),r(23123),r(66796)),T=r.n(N),C=r(96518),A=Z().shape({$loki:Z().number,time:Z().number,user:Z().string,text:Z().string,color:Z().string,hidden:Z().bool}),_=Z().objectOf(Z().shape({id:Z().string,src:Z().string})),D=/([^ ]+) x⁣([0-9]+)/g,I=function(e){var t=e.message,r=e.emotes,a=e.unpackMessages,o=e.showHidden,l=e.showEmotes;if(t.hidden&&!o)return null;var i=(0,n.useMemo)((function(){var e=t.text;return a&&(e=e.replace(D,(function(e,t,r){return T()("".concat(t," "),r).trimEnd()}))),l&&r&&(e=e.split(/\s+/).map((function(e,t){return r[e]&&(e=n.createElement("img",{key:t,src:r[e].src,alt:e,className:"emote"})),[t>0&&" ",e]}))),e}),[t.text,a,r,l]);return n.createElement(C.Z,null,n.createElement("span",{style:{color:t.color},className:"username"},t.user),": ",i)};I.propTypes={message:A.isRequired,emotes:_,unpackMessages:Z().bool.isRequired,showHidden:Z().bool.isRequired,showEmotes:Z().bool.isRequired},I.defaultProps={emotes:null},r(35666);var F=r(3050),U=r(57145);function M(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=q(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return l=e.done,e},e:function(e){i=!0,o=e},f:function(){try{l||null==r.return||r.return()}finally{if(i)throw o}}}}function q(e,t){if(e){if("string"==typeof e)return z(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?z(e,t):void 0}}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function H(e,t,r,n,a,o,l){try{var i=e[o](l),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,a)}var K=/\\N/g,$=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var r,n,a,o,l,i,c,s,u,f,m,d,p,y,v,h,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new F("chat"),n=r.addCollection("messages",{indices:["time"]}),e.next=4,fetch(t).then((function(e){return e.text()})).then((function(e){return e.split("\n")}));case 4:a=e.sent,o=!0,l=M(a),e.prev=7,l.s();case 9:if((i=l.n()).done){e.next=20;break}if(c=i.value,!o){e.next=15;break}if(c.startsWith("[Script Info]")){e.next=14;break}throw new Error("Файл повреждён или недоступен");case 14:o=!1;case 15:(s=c.startsWith("; "))&&(c=c.substring(2)),c.startsWith("Dialogue: ")&&(u=c.substring(10).split(", "),f=u.slice(3).join(", ").split(": "),m=function(e){if(Array.isArray(e))return e}(g=f)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(g)||q(g)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),d=m[0],p=m.slice(1),y=p.join(": ").replace(K,""),v=(0,U.h)(u[1]),h=d,b="inherit",d.startsWith("{\\c&H")&&(h=d.substring(13,13+d.length-26),b=d.substring(9,11)+d.substring(7,9)+d.substring(5,7),"#FFFFFF"===(b="#".concat(b))&&(b="inherit")),n.insert({time:v,user:h,text:y,color:b,hidden:s}));case 18:e.next=9;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(7),l.e(e.t0);case 25:return e.prev=25,l.f(),e.finish(25);case 28:return e.abrupt("return",n);case 29:case"end":return e.stop()}var g}),e,null,[[7,22,25,28]])})),function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function l(e){H(o,n,a,l,i,"next",e)}function i(e){H(o,n,a,l,i,"throw",e)}l(void 0)}))});return function(e){return t.apply(this,arguments)}}(),B=r(67439),L=r.n(B),W=r(88699);function V(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o=[],l=!0,i=!1;try{for(r=r.call(e);!(l=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);l=!0);}catch(e){i=!0,a=e}finally{try{l||null==r.return||r.return()}finally{if(i)throw a}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return X(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?X(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var G=function(e){var t=e.children,r=e.className,a=e.keepAtBottom,o=e.scrollTo,l=e.scrollDelay,i=e.contentKey,c=(0,n.useRef)(),s=V((0,n.useState)(!a),2),u=s[0],f=s[1],m=V((0,n.useState)(0),2),d=m[0],p=m[1],y=function(e){var t,r=c.current,n=null==r||null===(t=r.innerContainerRef.current)||void 0===t?void 0:t.querySelector(e);n&&(l?setTimeout((function(){return r.updateScrollPosition(n.offsetTop)}),l):r.updateScrollPosition(n.offsetTop))},v=(0,n.useCallback)((function(){var e;null===(e=c.current)||void 0===e||e.forceUpdate()})),h=(0,n.useCallback)((function(e){var t=e.entry;p((null==t?void 0:t.height)||0),v()})),b=(0,n.useCallback)((function(e){var t=e.target,r=t.scrollTop,n=t.scrollTopMax;f(r<.9*n)}));return(0,n.useEffect)((function(){a&&!u&&y(".bottom")}),[a,u,d,i]),(0,n.useEffect)((function(){o&&y(o)}),[o,i]),n.createElement(W.Z,{onResize:h},(function(e){var a=e.measureRef;return n.createElement("div",{ref:a,className:r,style:{display:"flex",flexDirection:"column"}},n.createElement(L(),{ref:c,onScroll:b,flex:"1 1 0"},n.createElement(W.Z,{onResize:v},(function(e){var r=e.measureRef;return n.createElement("div",{ref:r},t,n.createElement("div",{className:"bottom"}))}))))}))};G.propTypes={className:Z().string,keepAtBottom:Z().bool,scrollTo:Z().string,scrollDelay:Z().number,contentKey:Z().any},G.defaultProps={className:null,keepAtBottom:!1,scrollTo:null,scrollDelay:0,contentKey:null};var Y=r(49432),Q=function(e){var t=e.showHidden,r=e.emotes,a=e.showEmotes,o=e.unpackMessages,l=e.subtitles,i=e.onChange;return n.createElement("div",{className:"sidebar-row border-top d-flex"},n.createElement(s.Z,{placement:"top",overlay:function(e){return n.createElement(u.Z,e,"Показывать ответы ботов, команды и голоса на играх с интеграцией чата (",t?"включено":"выключено",")")}},n.createElement(c.Z,{variant:"dark",size:"sm",onClick:function(){return i({showHidden:!t})}},n.createElement(Y.e,{icon:S.VE0}),n.createElement("div",{className:"led ".concat(t?"bg-success":"bg-danger")}))),n.createElement(s.Z,{placement:"top",overlay:function(e){return n.createElement(u.Z,e,"Показывать смайлики Twitch, BetterTTV и FrankerFaceZ (",a?"включено":"выключено",")")}},n.createElement(c.Z,{className:"ms-1",variant:"dark",size:"sm",onClick:function(){return i({showEmotes:!a})}},a&&!r?n.createElement(R.Z,{animation:"border",size:"sm"}):n.createElement(Y.e,{icon:S.ctA}),n.createElement("div",{className:"led ".concat(a?"bg-success":"bg-danger")}))),n.createElement(s.Z,{placement:"top",overlay:function(e){return n.createElement(u.Z,e,'Распаковывать сообщения вида "Kappa x3" в "Kappa Kappa Kappa" (',o?"включено":"выключено",")")}},n.createElement(c.Z,{className:"ms-1",variant:"dark",size:"sm",onClick:function(){return i({unpackMessages:!o})}},n.createElement(Y.e,{icon:S.W2U}),n.createElement("div",{className:"led ".concat(o?"bg-success":"bg-danger")}))),n.createElement("div",{className:"flex-grow-1"}),n.createElement(s.Z,{placement:"top",overlay:function(e){return n.createElement(u.Z,e,"Скачать чат в виде субтитров")}},n.createElement(c.Z,{href:l,className:"ms-1",variant:"dark",size:"sm"},n.createElement(Y.e,{icon:S.q7m}))))};Q.propTypes={showHidden:Z().bool.isRequired,emotes:_,showEmotes:Z().bool.isRequired,unpackMessages:Z().bool.isRequired,subtitles:Z().string.isRequired,onChange:Z().func.isRequired},Q.defaultProps={emotes:null};var J=r(70160);function ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o=[],l=!0,i=!1;try{for(r=r.call(e);!(l=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);l=!0);}catch(e){i=!0,a=e}finally{try{l||null==r.return||r.return()}finally{if(i)throw a}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return te(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?te(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var re=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e},r=function(){return(null==e?void 0:e.currentTime)||0},a=(0,n.useRef)(r()),o=(0,n.useState)(a.current),l=ee(o,2),i=l[0],c=l[1];return(0,n.useEffect)((function(){var n=function(){var e=r();t(a.current)!==t(e)&&(a.current=e,c(e))};return null==e||e.on("timeupdate",n),function(){null==e||e.off("timeupdate",n)}}),[e]),i};function ne(){return ne=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ne.apply(this,arguments)}function ae(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function oe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(r),!0).forEach((function(t){le(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ae(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function le(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ie(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o=[],l=!0,i=!1;try{for(r=r.call(e);!(l=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);l=!0);}catch(e){i=!0,a=e}finally{try{l||null==r.return||r.return()}finally{if(i)throw a}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ce(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ce(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var se=function(e){var t=e.subtitles,r=e.plyr,a=e.offset,o=e.simple,l=ie((0,n.useState)(),2),i=l[0],s=l[1],u=ie((0,n.useState)(),2),m=u[0],d=u[1],p=ie((0,n.useState)(),2),v=p[0],h=p[1],b=ie((0,J.F)(P.Z.load("Chat",{showHidden:!1,showEmotes:!0,unpackMessages:!0})),2),g=b[0],E=b[1],O=(0,n.useRef)([null,null]),w=re(r,(function(e){var t=ie(O.current,2),r=t[0],n=t[1];return null!=r&&null!=n&&e>=r&&e<n||Math.floor(e)}));if((0,n.useEffect)((function(){P.Z.save("Chat",{},g,Object.keys(g))}),[g]),(0,n.useEffect)((function(){return i?null:($(t).then((function(e){return d(e)})).catch((function(e){return s(e.message)})),function(){return m&&m.clear()})}),[t,i]),(0,n.useEffect)((function(){!v&&g.showEmotes&&fetch("/data/emotes.json").then((function(e){return e.json()})).then((function(e){h(e)})).catch((function(){return h(null)}))}),[g.showEmotes]),i)return!o&&n.createElement("div",{className:"flex-1-0-0 d-flex flex-column justify-content-center align-items-center"},n.createElement("span",null,"Ошибка: ",i),n.createElement(c.Z,{variant:"primary",className:"mt-2",onClick:function(){return s(null)}},"Попробовать снова"));if(!m)return!o&&n.createElement("div",{className:"flex-1-0-0 d-flex flex-column justify-content-center align-items-center"},n.createElement(R.Z,{animation:"border",role:"status"}),n.createElement("span",{className:"mt-2"},"Загрузка сообщений..."));var S={};g.showHidden||(S.hidden={$eq:!1});var j=m.chain().find(oe(oe({},S),{},{time:{$lte:w-a}})).offset(-200).simplesort("$loki").data(),k=y()(j);O.current[0]=k?k.time+a:0;var x=m.chain().find(oe(oe({},S),{},{$loki:{$gt:(null==k?void 0:k.$loki)||0},time:{$gt:(null==k?void 0:k.time)||0}})).limit(1).data()[0];return O.current[1]=x?x.time+a:null,n.createElement(n.Fragment,null,n.createElement(G,{className:"flex-1-0-0",keepAtBottom:!0,contentKey:null==k?void 0:k.time},n.createElement(f.Z,{className:"chat-messages-list"},j.map((function(e){return n.createElement(I,ne({key:e.$loki,message:e,emotes:v},g))})))),!o&&n.createElement(Q,ne({onChange:E,emotes:v,subtitles:t},g)))};se.propTypes={subtitles:Z().string.isRequired,plyr:Z().object,offset:Z().number,simple:Z().bool},se.defaultProps={offset:0,simple:!1,plyr:null};var ue=r(21443),fe=r.n(ue),me=r(93041);function de(e){return de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},de(e)}function pe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ye(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ve(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function he(e,t){return he=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},he(e,t)}function be(e,t){if(t&&("object"===de(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ge(e)}function ge(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ee(e){return Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ee(e)}var Oe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&he(e,t)}(c,e);var t,r,o,l,i=(o=c,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ee(o);if(l){var r=Ee(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return be(this,e)});function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=i.call(this,e)).state=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(r),!0).forEach((function(t){ye(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},P.Z.load("Player",{chatOverlay:!0})),t.ref=n.createRef(),t.overlay=document.createElement("div"),t.overlay.className="plyr-overlay",t.onReady=t.onReady.bind(ge(t)),t.onTimeUpdate=t.onTimeUpdate.bind(ge(t)),t.onVideoEnded=t.onVideoEnded.bind(ge(t)),t.onFullScreenEnter=t.onFullScreenEnter.bind(ge(t)),t.onFullScreenExit=t.onFullScreenExit.bind(ge(t)),t.firstTimeUpdate=!0,t.firstReady=!0,t.hls=null,t}return t=c,(r=[{key:"plyrOptions",value:function(){return{settings:["captions","speed","loop"],invertTime:!1,seekTime:5,youtube:{controls:1,fs:!1,disablekb:0,cc_load_policy:0},keyboard:{global:!0}}}},{key:"updatePlyrSource",value:function(){var e,t=this.props,r=t.youtube,n=t.direct,a=t.hls,o=this.plyr.media,l={type:"video"};if(this.hls&&(null===(e=this.hls)||void 0===e||e.destroy(),delete this.hls),r)l.sources=[{provider:"youtube",src:r}];else{if(a&&me.Z.isSupported()){var i=new me.Z({maxBufferHole:5});return i.loadSource(a),i.attachMedia(o),void(this.hls=i)}l.sources=[{type:"video/mp4",src:n}]}this.plyr.source=l}},{key:"addControlButton",value:function(e){var t=e.before,r=void 0===t?'button[data-plyr="fullscreen"]':t,o=e.icon,l=void 0===o?S.lXL:o,i=e.value,c=void 0===i||i,s=e.onToggle,u=void 0===s?function(e){return e}:s,f=this.plyr.elements.controls,m=document.createElement("button");["plyr__controls__item","plyr__control","plyr__control__custom"].forEach((function(e){return m.classList.add(e)}));var d=document.createElement("span");m.appendChild(d),a.render(n.createElement(Y.e,{icon:l}),d),c?(m.pressed=!0,m.classList.add("plyr__control--pressed")):m.pressed=!1,m.onclick=function(){m.pressed?(m.pressed=!1,m.classList.remove("plyr__control--pressed")):(m.pressed=!0,m.classList.add("plyr__control--pressed")),u(m.pressed)};var p=f.querySelector(r);f.insertBefore(m,p)}},{key:"onReady",value:function(){var e,t=this,r=this.props,n=r.onReady,a=r.autostart,o=this.state.chatOverlay,l=this.firstReady;(void 0===l||l)&&(this.firstReady=!1,this.addControlButton({before:".plyr__menu",icon:S.lXL,value:o,onToggle:function(e){t.setState({chatOverlay:e})}}),n(this.plyr),a&&(null===(e=this.plyr.play())||void 0===e||e.catch((function(){return null}))))}},{key:"onTimeUpdate",value:function(){var e=this.props,t=e.forceStart,r=e.start,n=e.end,a=e.savedPositionAdapter,o=this.plyr,l=this.firstReady,i=void 0===l||l,c=this.firstTimeUpdate,s=void 0===c||c,u=this.lastSave,f=void 0===u?0:u,m=o.currentTime;if(!i&&s){this.firstTimeUpdate=!1;var d=(null==a?void 0:a.get())||0;r>0?o.currentTime=r:d>0&&(o.currentTime=Math.min(d,o.duration-30))}t&&m<r&&(o.currentTime=r),n&&m>=n&&(o.currentTime=n,o.pause()),Math.abs(m-f)>=5&&(this.lastSave=m,a.set(m))}},{key:"onVideoEnded",value:function(){var e=this.props,t=e.onVideoEnded,r=e.savedPositionAdapter,n=this.plyr.currentTime;r&&r.set(n,{end:!0}),t()}},{key:"onFullScreenEnter",value:function(){(0,this.props.onFullScreen)(!0)}},{key:"onFullScreenExit",value:function(){(0,this.props.onFullScreen)(!1)}},{key:"spawnPlyr",value:function(){var e=this,t=this.ref.current,r=document.createElement("video");t.appendChild(r);var n=new(fe())(r,this.plyrOptions());this.plyr=n,n.elements.container.appendChild(this.overlay),this.updatePlyrSource(),n.touch=!1;var a=this.props.poster;n.poster=a,n.on("ready",(function(t){e.props.direct||e.onReady(t)})),n.on("loadedmetadata",(function(t){var r=e.props,n=r.direct,a=r.hls;(n||a)&&e.onReady(t)})),n.on("timeupdate",this.onTimeUpdate),n.on("statechange",(function(e){var t;1===e.detail.code&&(null===(t=n.play())||void 0===t||t.catch((function(){return null})))})),n.on("playing",(function(){n.muted||(n.muted=!1),n.embed&&(n.volume=n.embed.getVolume()/100)})),n.on("enterfullscreen",(function(){e.plyr.elements.buttons.play[1].focus()})),n.on("ended",this.onVideoEnded),n.on("enterfullscreen",this.onFullScreenEnter),n.on("exitfullscreen",this.onFullScreenExit)}},{key:"destroyPlyr",value:function(){var e,t;(0,this.props.onDestroy)(),null===(e=this.hls)||void 0===e||e.destroy(),null===(t=this.plyr)||void 0===t||t.destroy();var r=this.ref.current;r.removeChild(r.querySelector("video"))}},{key:"componentDidMount",value:function(){this.spawnPlyr()}},{key:"shouldComponentUpdate",value:function(e,t){return P.Z.save("Player",this.state,t,["chatOverlay"]),!0}},{key:"componentDidUpdate",value:function(e){var t=this.plyr,r=this.props;e.youtube===r.youtube&&e.direct===r.direct&&e.poster===r.poster||(this.firstReady=!0,this.firstTimeUpdate=!0,this.updatePlyrSource(),t.poster=r.poster)}},{key:"componentWillUnmount",value:function(){this.destroyPlyr()}},{key:"render",value:function(){var e=this.props.renderOverlay,t=this.state.chatOverlay;return n.createElement(n.Fragment,null,a.createPortal(n.createElement(W.Z,null,(function(r){var a=r.contentRect.entry,o=r.measureRef;return n.createElement("div",{className:"plyr-overlay",ref:o},t&&e(a))})),this.overlay),n.createElement("div",{ref:this.ref}))}}])&&ve(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(n.Component);Oe.propTypes={youtube:Z().string,direct:Z().string,hls:Z().string,poster:Z().string,start:Z().number,autostart:Z().bool,end:Z().number,forceStart:Z().bool,savedPositionAdapter:Z().shape({get:Z().func,set:Z().func}),onReady:Z().func,onDestroy:Z().func,onFullScreen:Z().func,onVideoEnded:Z().func,renderOverlay:Z().func},Oe.defaultProps={youtube:null,direct:null,hls:null,poster:null,start:0,autostart:!1,end:null,forceStart:!1,savedPositionAdapter:null,onReady:function(){return null},onDestroy:function(){return null},onFullScreen:function(){return null},onVideoEnded:function(){return null},renderOverlay:function(){return null}},r(69720),r(85827);var we=r(52939),Se=["className","data"],je=["name","level"];function ke(){return ke=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ke.apply(this,arguments)}function Pe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o=[],l=!0,i=!1;try{for(r=r.call(e);!(l=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);l=!0);}catch(e){i=!0,a=e}finally{try{l||null==r.return||r.return()}finally{if(i)throw a}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return xe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?xe(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ze(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var Re=function(e){var t=e.value,r=e.plyr,a=(0,n.useMemo)((function(){return(0,U.h)(t)}),[t]),o=re(r,(function(e){return e>=a}))>=a,l=(0,n.useCallback)((function(e){var t;e.preventDefault(),r&&(r.currentTime=a,null===(t=r.play())||void 0===t||t.catch((function(){return null})))}),[r,a]);return n.createElement("a",{href:"#",className:o?"visited":"",onClick:l},t)};Re.propTypes={value:Z().string.isRequired,plyr:Z().object},Re.defaultProps={plyr:null};var Ne=function(e){var t=e.children;return n.createElement("span",{dangerouslySetInnerHTML:{__html:t}})},Te=n.forwardRef((function(e,t){var r=e.className,a=e.data,o=Ze(e,Se);return n.createElement(f.Z,{ref:t,className:["timecodes-list",r].join(" ")},Object.entries(a).map((function(e){var t=Pe(e,2),r=t[0],a=t[1];if("string"==typeof a){if(-1===r.indexOf("~"))return n.createElement(f.Z.Item,{key:r},n.createElement(Re,ke({value:r},o))," — ",n.createElement(Ne,null,a));var l=Pe(r.split("~"),2),i=l[0],c=l[1];return n.createElement(f.Z.Item,{key:r},n.createElement(Re,ke({value:i},o))," - ",n.createElement(Re,ke({value:c},o))," — ",n.createElement(Ne,null,a))}if(Array.isArray(a)){var s=a.map((function(e){if(-1===e.indexOf("~"))return n.createElement(Re,ke({key:e,value:e},o));var t=Pe(e.split("~"),2),r=t[0],a=t[1];return n.createElement("span",{key:e},n.createElement(Re,ke({value:r},o))," - ",n.createElement(Re,ke({value:a},o)))})).reduce((function(e,t){return[e,", ",t]}));return n.createElement(f.Z.Item,{key:a.join()},s," — ",n.createElement(Ne,null,r))}return n.createElement(Ce,ke({key:r,name:r,data:a},o))})))}));Te.propTypes={className:Z().string,plyr:Z().object,data:Z().object.isRequired},Te.defaultProps={className:"",plyr:null};var Ce=function(e){var t=e.name,r=e.level,a=Ze(e,je),o=Pe((0,n.useState)(!0),2),l=o[0],i=o[1],c=(0,n.useCallback)((function(){return i(!l)}),[l]);return n.createElement(n.Fragment,null,n.createElement(C.Z,{className:"d-flex",action:!0,onClick:c},n.createElement(Y.e,{icon:l?S.ptq:S._tD}),n.createElement("b",null,t)),n.createElement(we.Z,{in:l},n.createElement(Te,ke({className:"timecodes-nested-".concat(r),level:r+1},a))))};Ce.propTypes={name:Z().string.isRequired,level:Z().number},Ce.defaultProps={level:0};var Ae=r(27977),_e=r(62318),De=r(29119),Ie=r(87011),Fe=r(7438);function Ue(){return Ue=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ue.apply(this,arguments)}function Me(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o=[],l=!0,i=!1;try{for(r=r.call(e);!(l=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);l=!0);}catch(e){i=!0,a=e}finally{try{l||null==r.return||r.return()}finally{if(i)throw a}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return qe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qe(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var ze={variant:"dark",size:"sm"},He=function(e){var t=e.game,r=e.currentSegment,a=e.contentKey;return n.createElement(G,{className:"h-100",scrollTo:".active",scrollDelay:100,contentKey:a},n.createElement(f.Z,{className:"playlist-streams separator-v"},t.streams.map((function(e){return n.createElement(f.Z.Item,{key:e.segment,as:h.rU,to:e.url,action:!0,active:e.original===r,className:"playlist-streams-item"},n.createElement("span",{className:"flex-grow-1"},e.name),n.createElement("span",null,n.createElement(Ae.Z,{pill:!0,bg:"dark"},Ie.Z.format(e.original.date,"{dd}.{MM}"),n.createElement("br",null),e.original.date.getFullYear())))}))))};He.propTypes={game:Fe.lA.isRequired,currentSegment:Fe.XX.isRequired,contentKey:Z().any},He.defaultProps={contentKey:null};var Ke=function(e){var t=e.open,r=e.children;return n.createElement(we.Z,{in:t},n.createElement("div",null,n.createElement(De.e,{defaultSize:{height:"30vh"},enable:{bottom:!0}},r)))};Ke.propTypes={open:Z().bool.isRequired};var $e=function(e){var t=e.games,r=e.game,a=e.segment,o=e.autoExpand,l=e.fullHeight,i=Me((0,n.useState)(r),2),s=i[0],u=i[1],f=Me((0,n.useState)(o),2),m=f[0],d=f[1],p=t.indexOf(s),y=0!==p&&t[p-1],v=p!==t.length-1&&t[p+1];return(0,n.useEffect)((function(){u(r)}),[r]),n.createElement(n.Fragment,null,n.createElement(_e.Z,{className:"d-flex flex-row playlist-header separator-h"},n.createElement(c.Z,Ue({onClick:function(){return u(y)},disabled:!y},ze),n.createElement(Y.e,{icon:S.acZ})),n.createElement(c.Z,Ue({onClick:function(){return d(!m)},className:"flex-1-0-0",disabled:l},ze),s.name),n.createElement(c.Z,Ue({onClick:function(){return u(v)},disabled:!v},ze),n.createElement(Y.e,{icon:S.eFW}))),l?n.createElement(He,{game:s,currentSegment:a,contentKey:s.id}):n.createElement(Ke,{open:m},n.createElement(He,{game:s,currentSegment:a,contentKey:s.id+m})))};function Be(e){return Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Be(e)}$e.propTypes={games:Z().arrayOf(Fe.lA).isRequired,game:Fe.lA.isRequired,segment:Fe.XX.isRequired,autoExpand:Z().bool,fullHeight:Z().bool},$e.defaultProps={autoExpand:!1,fullHeight:!1};var Le=["el"];function We(){return We=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},We.apply(this,arguments)}function Ve(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Xe(e,t){return Xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Xe(e,t)}function Ge(e,t){if(t&&("object"===Be(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Ye(e){return Ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ye(e)}var Qe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Xe(e,t)}(i,e);var t,r,a,o,l=(a=i,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ye(a);if(o){var r=Ye(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Ge(this,e)});function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=l.call(this,e)).ref=n.createRef(),t}return t=i,(r=[{key:"componentDidMount",value:function(){var e=this.props.el,t=this.ref.current;t&&t.appendChild(e)}},{key:"render",value:function(){var e=this.props,t=(e.el,function(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}(e,Le));return n.createElement("div",We({ref:this.ref},t))}}])&&Ve(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),i}(n.PureComponent);Qe.propTypes={el:Z().object.isRequired};var Je=r(59928),et=r(7145),tt=r.n(et);const rt=function(e,t,r){e.setState(tt()(e.state,t),r)};var nt=r(93724),at=(r(60285),r(38966)),ot=r(2984),lt=r(23402),it=r(56626),ct=["segment","plyr"];function st(){return st=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},st.apply(this,arguments)}function ut(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o=[],l=!0,i=!1;try{for(r=r.call(e);!(l=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);l=!0);}catch(e){i=!0,a=e}finally{try{l||null==r.return||r.return()}finally{if(i)throw a}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ft(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ft(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ft(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var mt={link:"Ссылка",chat:"Чат",mpv:"MPV"},dt=function(e){var t=e.mode,r=e.onChange;return n.createElement(at.default,{size:"sm",className:"d-flex mb-0"},Object.entries(mt).map((function(e){var a=ut(e,2),o=a[0],l=a[1];return n.createElement(at.default.Item,{key:o,active:t===o,onClick:function(){return r(o)},className:"flex-1-0-0"},l)})))};dt.propTypes={mode:Z().string.isRequired,onChange:Z().func.isRequired};var pt=n.forwardRef((function(e,t){var r=e.segment,a=e.plyr,i=function(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}(e,ct),s=(0,n.useRef)(),u=Math.floor(re(a,(function(e){return Math.round(e)}))),f=ut((0,n.useState)("link"),2),m=f[0],d=f[1],p=ut((0,n.useState)(null),2),y=p[0],v=p[1],h=ut((0,n.useState)(u>0),2),b=h[0],g=h[1];if((0,n.useEffect)((function(){k.V.then((function(e){var t=e.segments;return v(t)}))}),[]),!y)return n.createElement(ot.Z,st({ref:t},i,{className:"share-popover"}),n.createElement(ot.Z.Header,{as:"h3"},"Создать короткую ссылку"),n.createElement(ot.Z.Body,{className:"d-flex justify-content-center"},n.createElement(R.Z,{animation:"border"})));var E,O=ut((0,nt.wk)(r,u),2),w=O[0],j=O[1],P=y.by("segment",w);switch(m){case"link":E=function(e,t){return(it.O4||window.location.origin)+"/r/"+e.segment+(t?"?at=".concat(t):"")}(b||-1===r.segment.indexOf(".")?P:r,b&&j);break;case"mpv":E=function(e,t){return["mpv",e.subtitles?"--sub-file=".concat(new URL(e.subtitles,window.location.href)):"",0!==e.abs_start?"--sub-delay=".concat(-e.abs_start):"",t?"--start=".concat(t):"",e.end?"--end=".concat(e.end):"",e.youtube?"ytdl://".concat(e.youtube):e.direct].filter((function(e){return e})).join(" ")}(r,b&&u);break;case"chat":E="!запись ".concat(P.segment).concat(b?" ".concat(j):"");break;default:E=""}return n.createElement(ot.Z,st({ref:t},i,{className:"share-popover"}),n.createElement(ot.Z.Header,{as:"h3"},"Создать короткую ссылку"),n.createElement(ot.Z.Body,null,n.createElement(o.Z,null,n.createElement(l.Z,null,n.createElement(_e.Z,null,n.createElement(lt.Z.Control,{ref:s,readOnly:!0,value:E,size:"sm"}),n.createElement(c.Z,{variant:"dark",size:"sm",onClick:function(){var e=s.current;e&&(e.select(),e.setSelectionRange(0,200),document.execCommand("copy"))}},n.createElement(Y.e,{icon:S.kZ_}))))),n.createElement(o.Z,{className:"mt-2"},n.createElement(l.Z,{className:"d-flex align-content-center"},n.createElement(lt.Z.Check,{className:"me-auto",type:"checkbox",label:"Начать с таймкода: ",checked:b,onChange:function(e){var t=e.target.checked;return g(t)}}),n.createElement(lt.Z.Control,{className:"time-selector",value:(0,U.y)(u),size:"sm",readOnly:!0,htmlSize:4}))),n.createElement(o.Z,{className:"mt-2"},n.createElement(l.Z,null,n.createElement(dt,{mode:m,onChange:d})))))}));pt.propTypes={segment:Fe.XX.isRequired,plyr:Z().object},pt.defaultProps={plyr:null};var yt=r(87872),vt=-1!==navigator.userAgent.toLowerCase().indexOf("prerender"),ht=function(e){var t=e.children;return!vt&&t},bt=r(74061);function gt(e){return gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gt(e)}function Et(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o=[],l=!0,i=!1;try{for(r=r.call(e);!(l=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);l=!0);}catch(e){i=!0,a=e}finally{try{l||null==r.return||r.return()}finally{if(i)throw a}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Ot(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ot(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ot(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function wt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function St(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?wt(Object(r),!0).forEach((function(t){jt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function jt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Pt(e,t){return Pt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Pt(e,t)}function xt(e,t){if(t&&("object"===gt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Zt(e)}function Zt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rt(e){return Rt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Rt(e)}var Nt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Pt(e,t)}(x,e);var t,r,p,b,E=(p=x,b=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Rt(p);if(b){var r=Rt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return xt(this,e)});function x(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,x),(t=E.call(this,e)).state=St({loaded:!1,error:!1,fullscreen:!1,segment:null,segmentRef:null,subRef:null,relatedGames:null,timecodes:null,plyr:null,toggleFullscreen:function(){return null}},P.Z.load("SegmentPlayer",{chatOverlay:{width:null,height:null,x:null,y:null},sidebarCollapsed:!1})),t.toggleSidebar=t.toggleSidebar.bind(Zt(t)),t.renderPlayerOverlay=t.renderPlayerOverlay.bind(Zt(t)),t.onTimeUpdate=t.onTimeUpdate.bind(Zt(t)),t.chatContainer=t.createChatContainer(),t}return t=x,r=[{key:"createChatContainer",value:function(){var e=document.createElement("div");return e.style.height="100%",e.style.display="flex",e.style.flexDirection="column",e}},{key:"resolveUrl",value:function(e){var t=e.segments,r=e.games,n=this.props.location,a=n.search,o=n.state,l=new URLSearchParams(a),i=l.has("at")?+l.get("at"):null,c=this.props.match.params,s=c.game,u=c.segment,f=Et((0,nt.K8)(t,u,i),3),m=f[0],d=f[1],p=f[2];if(!m)return null;var y=m.segment!==u;u=m.segment;var v,h=r.by("id",s);if(h&&-1!==m.games.indexOf(s))v=(0,nt.GG)(h,m);else{var b=Et((0,nt.PI)(r,m,d),2);h=b[0],v=b[1],s=h.id,y=!0}var g=St(St({},n),{},{pathname:"/play/".concat(s,"/").concat(m.segment),search:"?at=".concat(d)});return{segment:m,game:h,segmentRef:v,start:p,autostart:null==o?void 0:o.autostart,redirect:y&&g}}},{key:"loadData",value:function(){var e=this;k.V.then((function(t){var r=t.segments,n=t.timecodes,a=t.games,o=e.resolveUrl({segments:r,games:a});if(o){o.redirect&&g()().replace(o.redirect);var l=o.game,i=o.segment,c=o.segmentRef,s=o.start,u=o.autostart,f=i.games.map((function(e){return a.by("id",e)}));0===f.length&&(f=null),e.setState({loaded:!0,error:!1,segment:i,game:l,segmentRef:c,relatedGames:f,start:s,autostart:u}),n.then((function(t){e.setState({timecodes:t[i.segment]})}))}else e.setState({error:!0})}))}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"shouldComponentUpdate",value:function(e,t){return P.Z.save("SegmentPlayer",this.state,t,["chatOverlay","sidebarCollapsed"]),!0}},{key:"componentDidUpdate",value:function(e){var t=this.props.match.params,r=e.match.params;(t.segment!==r.segment||t.game!==r.game)&&this.loadData()}},{key:"toggleSidebar",value:function(){var e=this.state.sidebarCollapsed;if(!e){var t=document.body.style.pointerEvents;document.activeElement.blur(),document.body.style.pointerEvents="none",setTimeout((function(){document.body.style.pointerEvents=t}),100)}this.setState({sidebarCollapsed:!e})}},{key:"onTimeUpdate",value:function(){var e=this.state,t=e.plyr,r=e.segment.subrefs,n=e.subRef,a=t.currentTime,o=y()(r.filter((function(e){return e.start<a})));o!==n&&(o?this.setState({game:o.parent.game,segmentRef:o.parent,subRef:o}):this.setState({subRef:null}))}},{key:"renderPlayer",value:function(){var e=this,t=this.props.history,r=this.state,a=r.game,c=r.segment,s=r.segmentRef,u=r.segmentRef,f=u.end,m=u.force_start,d=r.segment,p=d.youtube,y=d.direct,v=d.hls,h={youtube:p,direct:y,poster:d.poster,hls:v,start:r.start,autostart:r.autostart,end:f,forceStart:m,savedPositionAdapter:{get:function(){return c.watched},set:c.setWatched},onVideoEnded:function(){var e=a.streams.indexOf(s)+1;e<a.streams.length&&t.push(a.streams[e].url)},onReady:function(t){e.setState({plyr:t,toggleFullscreen:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t.fullscreen.forceFallback=e,t.fullscreen.toggle(),t.elements.container.focus()}}),t.on("timeupdate",e.onTimeUpdate)},onFullScreen:function(t){return e.setState({fullscreen:t})},onDestroy:function(){return e.setState({plyr:null,toggleFullscreen:function(){return null}})},renderOverlay:this.renderPlayerOverlay};return n.createElement(o.Z,{className:"plyr-row"},n.createElement(l.Z,null,n.createElement(i.Z,{aspectRatio:"16x9",className:"plyr-ratio"},n.createElement(ht,null,n.createElement(Oe,h)))))}},{key:"renderPlayerOverlay",value:function(e){var t=this,r=e.width,a=e.height,o=this.state,l=o.fullscreen,i=o.segment.subtitles,c=o.chatOverlay;return l&&i?n.createElement(w.s,{className:"chat-overlay",position:{x:null!==c.x?c.x*r:0,y:null!==c.y?c.y*a:.65*a},minWidth:"100px",minHeight:"100px",size:{width:c.width?"".concat(100*c.width,"%"):"35%",height:c.height?"".concat(100*c.height,"%"):"35%"},onDragStop:function(e,n){var o=n.x,l=n.y;rt(t,{chatOverlay:{$merge:{x:o/r,y:l/a}}})},onResizeStop:function(e,n,o,l,i){rt(t,{chatOverlay:{$merge:{width:o.offsetWidth/r,height:o.offsetHeight/a,x:i.x/r,y:i.y/a}}})},bounds:"parent"},this.renderChat()):null}},{key:"renderPlayerControls",value:function(){var e=this.state,t=e.toggleFullscreen,r=e.segment,a=e.plyr,i=r.segment,f=r.youtube,m=r.vk,d=r.official,p=r.torrent,y=Ie.Z.monthsAgo(r.date)>=2;return n.createElement(o.Z,{className:"g-0"},n.createElement(l.Z,null,n.createElement("div",{className:"player-controls border-top border-bottom"},y||n.createElement(c.Z,{variant:"dark",size:"sm",className:"me-2",href:"https://twitch.tv/videos/".concat(i),target:"blank"},n.createElement(Y.e,{icon:j.z0T}),n.createElement("span",null,"Twitch")),f&&n.createElement(c.Z,{href:"https://youtu.be/".concat(f),target:"blank",variant:"dark",size:"sm",className:"me-2"},n.createElement(Y.e,{icon:j.opf}),n.createElement("span",null,"YouTube"),n.createElement(s.Z,{placement:"top",overlay:n.createElement(u.Z,null,!1===d?"Неофициальный канал":"Официальный канал")},n.createElement(Y.e,{icon:!1===d?S.RLE:S.f8k,className:!1===d?"text-warning":"text-success"}))),m&&n.createElement(c.Z,{href:"https://vk.com/video".concat(m),target:"blank",variant:"dark",size:"sm",className:"me-2"},n.createElement(Y.e,{icon:j.iD2}),n.createElement("span",null,"VK")),p&&n.createElement(c.Z,{href:p,variant:"dark",size:"sm",className:"me-2"},n.createElement(Y.e,{icon:S.q7m}),n.createElement("span",{className:"d-none d-xl-inline"},"Торрент")),n.createElement("div",{className:"flex-grow-1"}),n.createElement(s.Z,{trigger:"click",rootClose:!0,placement:"top",overlay:n.createElement(pt,{segment:r,plyr:a})},n.createElement(c.Z,{variant:"dark",size:"sm",className:"me-2"},n.createElement(Y.e,{icon:S.tFX}),n.createElement("span",{className:"d-none d-xl-inline"},"Поделиться"))),n.createElement(s.Z,{placement:"top",overlay:function(e){return n.createElement(u.Z,e,"Оставить в окне только плеер, но не переходить в полноэкранный режим")}},n.createElement(c.Z,{variant:"dark",size:"sm",onClick:function(){return t(!0)},className:"me-2"},n.createElement(Y.e,{icon:S.HHh}),n.createElement("span",{className:"d-none d-lg-inline"},"На всё окно"))),n.createElement(s.Z,{placement:"top",overlay:function(e){return n.createElement(u.Z,e,"Развернуть плеер на весь экран")}},n.createElement(c.Z,{variant:"dark",size:"sm",onClick:function(){return t(!1)}},n.createElement(Y.e,{icon:S.TL5}),n.createElement("span",{className:"d-none d-lg-inline"},"На весь экран"))))))}},{key:"renderChat",value:function(){var e=this.state,t=e.fullscreen,r=e.plyr,a=e.segment,o=a.subtitles,l=a.abs_start,i=n.createElement("div",{className:"sidebar-header"},"Чат");return o?n.createElement(ht,null,!t&&i,n.createElement(se,{plyr:r,offset:-l,subtitles:o,simple:t})):n.createElement(n.Fragment,null,i,n.createElement("div",{className:"p-4 flex-grow-1 align-self-center text-white"},"Для этого стрима нет записи чата :("))}},{key:"renderTimecodes",value:function(){var e=this.state,t=e.timecodes,r=e.plyr;return n.createElement(n.Fragment,null,n.createElement("div",{className:"sidebar-header"},"Таймкоды"),n.createElement(G,{className:"flex-1-1-0"},n.createElement(Te,{data:t,plyr:r})))}},{key:"renderPlaylist",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.autoExpand,r=void 0!==t&&t,a=e.fullHeight,o=void 0!==a&&a,l=this.state,i=l.segment,c=l.game,s=l.relatedGames;return s?n.createElement(n.Fragment,null,n.createElement("div",{className:"sidebar-header"},"Плейлист"),n.createElement($e,{games:s,game:c,segment:i,autoExpand:r,fullHeight:o})):null}},{key:"renderLeftSidebar",value:function(){var e=this.state,t=e.sidebarCollapsed,r=e.timecodes,a=e.relatedGames,o=e.segment.subtitles,i=["col-sidebar-narrow border-end",t?"collapsed":""].join(" ");return o?n.createElement(n.Fragment,null,(r||a)&&n.createElement(O(),{minDeviceWidth:1200},n.createElement(l.Z,{className:i,tabIndex:"0"},n.createElement("div",{className:"content"},n.createElement("div",{className:"sidebar-row-overlay flex-row-reverse"},n.createElement(c.Z,{variant:"link",size:"sm",onClick:this.toggleSidebar},n.createElement(Y.e,{icon:t?S.lLQ:S.cir}))),a&&this.renderPlaylist(),r&&this.renderTimecodes()),n.createElement("div",{className:"collapsed-content"},a&&n.createElement("div",{className:"sidebar-header"},"Плейлист"),r&&n.createElement("div",{className:"sidebar-header"},"Таймкоды")))),(r||a)&&n.createElement(O(),{minDeviceWidth:768,maxDeviceWidth:1199},n.createElement(l.Z,{className:"col-sidebar-narrow collapsed",tabIndex:"0"},n.createElement("div",{className:"content border-end"},a&&this.renderPlaylist(),r&&this.renderTimecodes()),n.createElement("div",{className:"collapsed-content"},a&&n.createElement("div",{className:"sidebar-header"},"Плейлист"),r&&n.createElement("div",{className:"sidebar-header"},"Таймкоды"))))):null}},{key:"renderRightSidebar",value:function(){var e=this.chatContainer,t=this.state,r=t.fullscreen,a=t.relatedGames,o=t.timecodes,i=t.segment.subtitles;return i||a||o?n.createElement(O(),{minDeviceWidth:768},n.createElement(l.Z,{className:"col-sidebar-wide border-start"},i&&!r&&n.createElement(Qe,{el:e,className:"flex-1-1-0"}),!i&&a&&this.renderPlaylist(),!i&&o&&this.renderTimecodes())):null}},{key:"renderDescription",value:function(){var e=this.state,t=e.game,r=e.segment,a=e.segmentRef,i=e.subRef;return n.createElement(o.Z,{className:"stream-description"},n.createElement(l.Z,null,n.createElement("h3",null,n.createElement(h.rU,{to:t.url},t.name),n.createElement("span",null," — "),n.createElement("span",{className:"flex-grow-1"},(null==i?void 0:i.name)||a.name)),n.createElement(f.Z,{variant:"flush",size:"sm"},n.createElement(f.Z.Item,null,"Дата стрима:"," ",Ie.Z.medium(r.date)," ","(",Ie.Z.relative(r.date),")"),r.note&&n.createElement(f.Z.Item,{dangerouslySetInnerHTML:{__html:r.note}}))))}},{key:"renderBelowPlayer",value:function(){var e=this,t=this.chatContainer,r=this.state,a=r.fullscreen,i=r.relatedGames,c=r.timecodes,s=r.segment.subtitles;return n.createElement(n.Fragment,null,n.createElement(O(),{minDeviceWidth:768},this.renderDescription()),n.createElement(O(),{maxDeviceWidth:767},n.createElement(O(),{maxDeviceWidth:575},(function(r){return n.createElement(o.Z,{className:"flex-grow-1 flex-shrink-1 g-0"},n.createElement(l.Z,{className:"sidebar-content"},n.createElement(m.Z,{mountOnEnter:!0},n.createElement(d.Z,{eventKey:"description",title:"Описание"},r?e.renderDescription():n.createElement(G,{className:"flex-1-1-0"},e.renderDescription())),c&&n.createElement(d.Z,{eventKey:"timecodes",title:"Таймкоды"},e.renderTimecodes()),i&&n.createElement(d.Z,{eventKey:"playlist",title:"Плейлист",unmountOnExit:!0},e.renderPlaylist({autoExpand:!0,fullHeight:!0})),s&&r&&n.createElement(d.Z,{eventKey:"chat",title:"Чат"},!a&&n.createElement(Qe,{el:t,className:"flex-1-1-0"})))),s&&!r&&n.createElement(l.Z,{className:"sidebar-content border-start"},!a&&n.createElement(Qe,{el:t,className:"flex-1-1-0"})))}))))}},{key:"render",value:function(){var e=this.state,t=e.loaded;if(e.error)return n.createElement(Je.Z,null);if(!t)return n.createElement(yt.A,{fluid:!0,flex:!0,withFooter:!1,isLoading:!0});var r=this.chatContainer,i=this.state,c=i.segment,s=c.segment,u=c.subtitles,f=c.thumbnail,m=c.date,d=i.segmentRef,p=i.subRef,y=i.game,h=y.id,b=y.name,g="".concat((null==p?void 0:p.name)||d.name," | ").concat(b),E=bt.Z.PLAYER.replace(":game",h).replace(":segment",s);return n.createElement(yt.A,{fluid:!0,flex:!0,withFooter:!1,title:g,canonicalPath:E},n.createElement(v.ql,null,n.createElement("meta",{property:"og:description",content:"Запись стрима от ".concat(Ie.Z.medium(m))}),f.startsWith("http")&&n.createElement("meta",{property:"og:image",content:f})),u&&a.createPortal(this.renderChat(),r),n.createElement(o.Z,{className:"flex-grow-1 g-0"},this.renderLeftSidebar(),n.createElement(l.Z,{className:"d-flex flex-column"},this.renderPlayer()," ",this.renderPlayerControls(),this.renderBelowPlayer()),this.renderRightSidebar()))}}],r&&kt(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),x}(n.Component)},70160:(e,t,r)=>{r.d(t,{F:()=>c}),r(82526),r(41817),r(41539),r(32165),r(66992),r(78783),r(33948),r(47042),r(68309),r(91038),r(74916),r(77601),r(21703),r(47941),r(57327),r(38880),r(54747),r(49337);var n=r(67294);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var c=function(e){var t,r,a=(t=(0,n.useState)(e),r=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o=[],l=!0,i=!1;try{for(r=r.call(e);!(l=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);l=!0);}catch(e){i=!0,a=e}finally{try{l||null==r.return||r.return()}finally{if(i)throw a}}return o}}(t,r)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=a[0],c=a[1];return[l,(0,n.useCallback)((function(e){return c((function(t){return o(o({},t),e)}),[])}))]}}}]);
//# sourceMappingURL=54.bundle.js.map