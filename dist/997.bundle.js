"use strict";(self.webpackChunkblacksilverufa=self.webpackChunkblacksilverufa||[]).push([[997],{85997:(e,t,r)=>{r.r(t),r.d(t,{default:()=>jt});var n=r(67294),a=r(73935),o=r(34051),l=r(31555),i=r(84883),c=r(35005),s=r(40881),u=r(43489),f=r(16714),m=r(85509),p=r(17905),d=r(70405),y=r(73727),h=r(1852),v=r.n(h),b=r(57371),g=r(57569),E=r(10928),O=r.n(E),S=r(4788),w=r.n(S);function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function j(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var x=JSON.parse(localStorage.getItem("resume_playback"))||{},P=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.streams=t.streams,this.offsets=t.offsets||[t.abs_start]}var t,r;return t=e,(r=[{key:"set",value:function(e){var t=null;if(e=Math.round(e),w()(this.streams,this.offsets).forEach((function(r){var n,a,o=(a=2,function(e){if(Array.isArray(e))return e}(n=r)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,a=!1,o=void 0;try{for(var l,i=e[Symbol.iterator]();!(n=(l=i.next()).done)&&(r.push(l.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw o}}return r}}(n,a)||function(e,t){if(e){if("string"==typeof e)return k(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?k(e,t):void 0}}(n,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=o[0],i=o[1];e>=i&&(t={stream:l,offset:i}),delete x[l]})),t){var r=t,n=r.stream,a=r.offset;x[n]=e-a,localStorage.setItem("resume_playback",JSON.stringify(x))}}},{key:"get",value:function(){var e=this;return O()(this.streams.map((function(t,r){return+x[t]+e.offsets[r]})).filter((function(e){return!Number.isNaN(e)})))}},{key:"exists",value:function(){for(var e=0;e<this.streams.length;e+=1)if(x[this.streams[e]])return!0;return!1}}])&&j(t.prototype,r),e}(),T=r(82492),R=r.n(T),N=r(96774),C=r.n(N);function Z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var _=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"save",value:function(e,t,r,n){var a={},o={};n.forEach((function(e){a[e]=r[e],o[e]=t[e]})),C()(a,o)||localStorage.setItem("state-".concat(e),JSON.stringify(a))}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return R()({},t,JSON.parse(localStorage.getItem("state-".concat(e)))||{})}}],null&&Z(t.prototype,null),r&&Z(t,r),e}(),A=r(45697),D=r.n(A),I=r(3050),F=r(96518),U=r(36968),H=r(57145),z=r(67439),B=r.n(z),M=r(88699),q=r(75613),W=r.n(q);function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}function K(){return K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},K.apply(this,arguments)}function $(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function G(e,t){return G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},G(e,t)}function J(e,t){return!t||"object"!==L(t)&&"function"!=typeof t?V(e):t}function V(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Y(e){return Y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Y(e)}var Q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&G(e,t)}(i,e);var t,r,a,o,l=(a=i,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Y(a);if(o){var r=Y(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return J(this,e)});function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=l.call(this,e)).scrollRef=n.createRef(),t.onSizeChange=t.onSizeChange.bind(V(t)),t.outerHeight=0,t.prevOuterHeight=0,t.outerWidth=0,t.prevOuterWidth=0,t}return t=i,(r=[{key:"onSizeChange",value:function(){this.scrollRef.current&&this.scrollRef.current.forceUpdate()}},{key:"scrollToSelector",value:function(e){var t=this.props.smooth,r=this.scrollRef.current.innerContainerRef.current,n=r.querySelector(e);n&&setTimeout((function(){W()(n,{elementToScroll:r,maxDuration:t?1e3:0})}),100)}},{key:"componentDidMount",value:function(){var e=this.props,t=e.scrollToSelector,r=e.keepAtBottom;t?this.scrollToSelector(t):r&&this.keepAtBottom()}},{key:"componentDidUpdate",value:function(e){var t=this.props,r=t.scrollToSelector,n=t.contentKey;r&&(e.scrollToSelector===r&&e.contentKey===n||this.scrollToSelector(r))}},{key:"keepAtBottom",value:function(){var e=this.scrollRef.current,t=this.props,r=t.keepAtBottom,n=t.bottomSelector;r&&e&&this.scrollToSelector(n)}},{key:"render",value:function(){var e=this,t=this.props,r=t.children,a=(t.scrollToSelector,t.flex),o=t.heightRelativeToParent,l=function(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}(t,["children","scrollToSelector","flex","heightRelativeToParent"]),i={};return a?i.flex=a:o&&(i.height=o),n.createElement(M.Z,{onResize:this.onSizeChange},(function(t){var a=t.contentRect.entry,o=a.width,c=a.height,s=t.measureRef;return e.prevOuterHeight=e.outerHeight,e.outerHeight=c,e.prevOuterWidth=e.outerWidth,e.outerWidth=o,e.prevOuterHeight===e.outerHeight&&e.prevOuterWidth===e.outerWidth||e.keepAtBottom(),n.createElement("div",{ref:s,style:i,className:"scroll-outer"},n.createElement(B(),K({ref:e.scrollRef,flex:"1 1 0"},l),n.createElement(M.Z,{onResize:e.onSizeChange},(function(e){var t=e.measureRef;return n.createElement("div",{ref:t},r)}))))}))}}])&&$(t.prototype,r),i}(n.Component);function X(e){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(e)}function ee(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=te(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return l=e.done,e},e:function(e){i=!0,o=e},f:function(){try{l||null==r.return||r.return()}finally{if(i)throw o}}}}function te(e,t){if(e){if("string"==typeof e)return re(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?re(e,t):void 0}}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ne(e,t,r,n,a,o,l){try{var i=e[o](l),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,a)}function ae(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function l(e){ne(o,n,a,l,i,"next",e)}function i(e){ne(o,n,a,l,i,"throw",e)}l(void 0)}))}}function oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function le(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ce(e,t){return ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ce(e,t)}function se(e,t){return!t||"object"!==X(t)&&"function"!=typeof t?ue(e):t}function ue(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fe(e){return fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},fe(e)}Q.propTypes={scrollToSelector:D().string,smooth:D().bool,flex:D().string,heightRelativeToParent:D().string,keepAtBottom:D().bool,bottomSelector:D().string,contentKey:D().any},Q.defaultProps={scrollToSelector:null,smooth:!1,flex:null,heightRelativeToParent:null,keepAtBottom:!1,bottomSelector:"* + :last-child",contentKey:null};var me=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ce(e,t)}(p,e);var t,r,a,o,l,i,m=(l=p,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=fe(l);if(i){var r=fe(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return se(this,e)});function p(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),(t=m.call(this,e)).state=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(r),!0).forEach((function(t){le(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({loaded:!1,error:null,maxItems:100},_.load("Chat",{showHidden:!1})),t.toggleShowHidden=t.toggleShowHidden.bind(ue(t)),t.tryLoadData=t.tryLoadData.bind(ue(t)),t}return t=p,r=[{key:"loadData",value:(o=ae(regeneratorRuntime.mark((function e(){var t,r,n,a,o,l,i,c,s,u,f,m,p,d,y,h,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.subtitles,this.db=new I(O()(t.split("/"))),this.data=this.db.addCollection("subtitles",{indices:["time"]}),e.next=5,fetch(t).then((function(e){return e.text()})).then((function(e){return e.split("\n")}));case 5:r=e.sent,n=/\\N/g,a=!0,o=ee(r),e.prev=9,o.s();case 11:if((l=o.n()).done){e.next=22;break}if(i=l.value,!a){e.next=17;break}if(i.startsWith("[Script Info]")){e.next=16;break}throw new Error("Файл повреждён или недоступен");case 16:a=!1;case 17:(c=i.startsWith("; "))&&(i=i.substr(2)),i.startsWith("Dialogue: ")&&(s=i.substr(10).split(", "),u=s.slice(3).join(" ").split(": "),f=function(e){if(Array.isArray(e))return e}(b=u)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(b)||te(b)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),m=f[0],p=f.slice(1),d=p.join(": ").replace(n,""),y=(0,H.h)(s[1]),h=m,v="inherit",m.startsWith("{\\c&H")&&(h=m.substr(13,m.length-26),v=m.substr(9,2)+m.substr(7,2)+m.substr(5,2),"#FFFFFF"===(v="#".concat(v))&&(v="inherit")),this.data.insert({time:y,user:h,text:d,color:v,hidden:c}));case 20:e.next=11;break;case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(9),o.e(e.t0);case 27:return e.prev=27,o.f(),e.finish(27);case 30:this.setState({loaded:!0});case 31:case"end":return e.stop()}var b}),e,this,[[9,24,27,30]])}))),function(){return o.apply(this,arguments)})},{key:"tryLoadData",value:(a=ae(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loaded:!1,error:null}),e.prev=1,e.next=4,this.loadData();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),this.setState({error:e.t0.message});case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return a.apply(this,arguments)})},{key:"destroyData",value:function(){this.setState({loaded:!1}),this.db&&(this.db.clearChanges(),this.db.close(),this.data=null,this.db=null)}},{key:"shouldComponentUpdate",value:function(e,t){return _.save("Chat",this.state,t,["showHidden"]),!0}},{key:"componentDidUpdate",value:function(e){this.props.subtitles!==e.subtitles&&(this.destroyData(),this.tryLoadData())}},{key:"componentDidMount",value:function(){this.tryLoadData()}},{key:"componentWillUnmount",value:function(){this.destroyData()}},{key:"getMessages",value:function(){var e=this.props,t=e.currentTime,r=e.offset,n=this.state,a=n.maxItems,o={time:{$lte:t-r}};return n.showHidden||(o.hidden={$eq:!1}),this.data.chain().find(o).offset(-a).data()}},{key:"toggleShowHidden",value:function(){var e=this.state.showHidden;this.setState({showHidden:!e})}},{key:"renderMessages",value:function(){return n.createElement(f.Z,{className:"chat-messages-list"},this.getMessages().map((function(e){return n.createElement(F.Z,{key:e.$loki},n.createElement("span",{style:{color:e.color},className:"username"},e.user),": ",e.text)})))}},{key:"renderScrollable",value:function(){return n.createElement(Q,{flex:"1 0 0",keepAtBottom:!0},this.renderMessages())}},{key:"render",value:function(){var e=this.state,t=e.loaded,r=e.error,a=e.showHidden,o=this.props.simple;return r?o?null:n.createElement("div",{className:"flex-1-0-0 d-flex flex-column justify-content-center align-items-center"},n.createElement("span",null,"Ошибка: ",r),n.createElement(c.Z,{variant:"primary",className:"mt-2",onClick:this.tryLoadData},"Попробовать снова")):t?o?this.renderScrollable():n.createElement(n.Fragment,null,this.renderScrollable(),n.createElement("div",{className:"sidebar-row border-top d-flex"},n.createElement(s.Z,{placement:"top",overlay:function(e){return n.createElement(u.Z,e,a?"Скрывать ":"Показывать ","ботов, команды и голоса на играх с интеграцией чата")}},n.createElement(c.Z,{variant:"dark",size:"sm",onClick:this.toggleShowHidden},a?n.createElement("i",{className:"far fa-eye"}):n.createElement("i",{className:"far fa-eye-slash"}))))):o?null:n.createElement("div",{className:"flex-1-0-0 d-flex flex-column justify-content-center align-items-center"},n.createElement(U.Z,{animation:"border",role:"status"}),n.createElement("span",{className:"mt-2"},"Загрузка сообщений..."))}}],r&&ie(t.prototype,r),p}(n.Component);me.propTypes={subtitles:D().string.isRequired,currentTime:D().number.isRequired,offset:D().number,simple:D().bool},me.defaultProps={offset:0,simple:!1};var pe=r(21443),de=r.n(pe);function ye(e){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(e)}function he(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ve(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function be(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ge(e,t){return ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ge(e,t)}function Ee(e,t){return!t||"object"!==ye(t)&&"function"!=typeof t?Oe(e):t}function Oe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Se(e){return Se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Se(e)}var we=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ge(e,t)}(c,e);var t,r,o,l,i=(o=c,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Se(o);if(l){var r=Se(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Ee(this,e)});function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=i.call(this,e)).state=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?he(Object(r),!0).forEach((function(t){ve(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):he(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},_.load("Player",{chatOverlay:!0})),t.ref=n.createRef(),t.overlay=document.createElement("div"),t.overlay.className="plyr-overlay",t.onReady=t.onReady.bind(Oe(t)),t.onTimeUpdate=t.onTimeUpdate.bind(Oe(t)),t.onFullScreenEnter=t.onFullScreenEnter.bind(Oe(t)),t.onFullScreenExit=t.onFullScreenExit.bind(Oe(t)),t.firstTimeUpdate=!0,t.firstReady=!0,t}return t=c,(r=[{key:"plyrOptions",value:function(){return{settings:["captions","speed","loop"],invertTime:!1,youtube:{controls:1,fs:!1},keyboard:{global:!0}}}},{key:"plyrSource",value:function(){var e=this.props,t=e.youtube,r=e.direct,n={type:"video"};return n.sources=t?[{provider:"youtube",src:t}]:[{type:"video/mp4",src:r}],n}},{key:"addControlButton",value:function(e){var t=e.before,r=void 0===t?'button[data-plyr="fullscreen"]':t,n=e.iconClass,a=void 0===n?"fas fa-comments":n,o=e.value,l=void 0===o||o,i=e.onToggle,c=void 0===i?function(e){return e}:i,s=this.plyr.elements.controls,u=document.createElement("button");["plyr__controls__item","plyr__control","plyr__control__custom"].forEach((function(e){return u.classList.add(e)}));var f=document.createElement("i");a.split(" ").forEach((function(e){return f.classList.add(e)})),u.appendChild(f),l?(u.pressed=!0,u.classList.add("plyr__control--pressed")):u.pressed=!1,u.onclick=function(){u.pressed?(u.pressed=!1,u.classList.remove("plyr__control--pressed")):(u.pressed=!0,u.classList.add("plyr__control--pressed")),c(u.pressed)};var m=s.querySelector(r);s.insertBefore(u,m)}},{key:"onReady",value:function(){var e,t=this,r=this.props,n=r.onReady,a=r.autostart,o=this.state.chatOverlay,l=this.firstReady;(void 0===l||l)&&(this.firstReady=!1,this.addControlButton({before:".plyr__menu",iconClass:"fas fa-comments",value:o,onToggle:function(e){t.setState({chatOverlay:e})}}),n(this.plyr),a&&(null===(e=this.plyr.play())||void 0===e||e.catch((function(){return null}))))}},{key:"onTimeUpdate",value:function(){var e=this.props,t=e.onTimeChange,r=e.forceStart,n=e.start,a=e.autostart,o=e.end,l=e.savedPositionAdapter,i=this.plyr,c=this.firstReady,s=void 0===c||c,u=this.firstTimeUpdate,f=void 0===u||u,m=this.lastCallback,p=void 0===m?-.25:m,d=this.lastSave,y=void 0===d?0:d,h=i.currentTime;!s&&f&&(this.firstTimeUpdate=!1,h<1&&(a?i.currentTime=a:l&&l.exists()?i.currentTime=l.get():h<n&&(i.currentTime=n))),r&&h<n&&(i.currentTime=n),o&&h>=o&&(i.currentTime=o,i.pause()),Math.abs(h-p)>=.25&&(this.lastCallback=h,t(h)),Math.abs(h-y)>=5&&(this.lastSave=h,l.set(h))}},{key:"onFullScreenEnter",value:function(){(0,this.props.onFullScreen)(!0)}},{key:"onFullScreenExit",value:function(){(0,this.props.onFullScreen)(!1)}},{key:"spawnPlyr",value:function(){var e=this,t=this.ref.current,r=document.createElement("video");t.appendChild(r);var n=new(de())(r,this.plyrOptions());this.plyr=n,n.elements.container.appendChild(this.overlay),n.source=this.plyrSource(),n.touch=!1,n.on("ready",(function(t){e.props.direct||e.onReady(t)})),n.on("loadedmetadata",(function(t){e.props.direct&&e.onReady(t)})),n.on("timeupdate",this.onTimeUpdate),n.on("statechange",(function(e){1===e.detail.code&&n.play()})),n.on("playing",(function(){n.muted||(n.muted=!1),n.embed&&(n.volume=n.embed.getVolume()/100)})),n.on("enterfullscreen",this.onFullScreenEnter),n.on("exitfullscreen",this.onFullScreenExit)}},{key:"destroyPlyr",value:function(){(0,this.props.onDestroy)(),this.plyr.destroy();var e=this.ref.current;e.removeChild(e.querySelector("video"))}},{key:"componentDidMount",value:function(){this.spawnPlyr()}},{key:"shouldComponentUpdate",value:function(e,t){return _.save("Player",this.state,t,["chatOverlay"]),!0}},{key:"componentDidUpdate",value:function(e){var t=this.plyr,r=this.props;e.youtube===r.youtube&&e.direct===r.direct||(this.firstReady=!0,this.firstTimeUpdate=!0,t.source=this.plyrSource())}},{key:"componentWillUnmount",value:function(){this.destroyPlyr()}},{key:"render",value:function(){var e=this.props.renderOverlay,t=this.state.chatOverlay;return n.createElement(n.Fragment,null,a.createPortal(n.createElement(M.Z,null,(function(r){var a=r.contentRect.entry,o=r.measureRef;return n.createElement("div",{className:"plyr-overlay",ref:o},t&&e(a))})),this.overlay),n.createElement("div",{ref:this.ref,className:"plyr-row"}))}}])&&be(t.prototype,r),c}(n.Component);we.propTypes={youtube:D().string,direct:D().string,start:D().number,autostart:D().number,end:D().number,forceStart:D().bool,savedPositionAdapter:D().object,onReady:D().func,onDestroy:D().func,onTimeChange:D().func,onFullScreen:D().func,renderOverlay:D().func},we.defaultProps={youtube:null,direct:null,start:0,autostart:null,end:null,forceStart:!1,savedPositionAdapter:null,onReady:function(){return null},onDestroy:function(){return null},onTimeChange:function(){return null},onFullScreen:function(){return null},renderOverlay:function(){return null}};var ke=r(52939);function je(){return je=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},je.apply(this,arguments)}function xe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,a=!1,o=void 0;try{for(var l,i=e[Symbol.iterator]();!(n=(l=i.next()).done)&&(r.push(l.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw o}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Pe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Pe(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Te(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var Re=function(e){var t=e.value,r=e.currentTime,a=e.setTime,o=(0,n.useMemo)((function(){return(0,H.h)(t)}),[t]),l=r>=o,i=(0,n.useCallback)((function(e){e.preventDefault(),a(o)}),[a,o]);return n.createElement("a",{href:"#",className:l?"visited":"",onClick:i},t)};Re.propTypes={value:D().string.isRequired,currentTime:D().number,setTime:D().func},Re.defaultProps={currentTime:0,setTime:function(){return null}};var Ne=function(e){var t=e.children;return n.createElement("span",{dangerouslySetInnerHTML:{__html:t}})},Ce=n.forwardRef((function(e,t){var r=e.className,a=e.data,o=Te(e,["className","data"]);return n.createElement(f.Z,{ref:t,className:["timecodes-list",r].join(" ")},Object.entries(a).map((function(e){var t=xe(e,2),r=t[0],a=t[1];if("string"==typeof a){if(-1===r.indexOf("~"))return n.createElement(f.Z.Item,{key:r},n.createElement(Re,je({value:r},o))," — ",n.createElement(Ne,null,a));var l=xe(r.split("~"),2),i=l[0],c=l[1];return n.createElement(f.Z.Item,{key:r},n.createElement(Re,je({value:i},o))," - ",n.createElement(Re,je({value:c},o))," — ",n.createElement(Ne,null,a))}if(Array.isArray(a)){var s=a.map((function(e){if(-1===e.indexOf("~"))return n.createElement(Re,je({key:e,value:e},o));var t=xe(e.split("~"),2),r=t[0],a=t[1];return n.createElement("span",{key:e},n.createElement(Re,je({value:r},o))," - ",n.createElement(Re,je({value:a},o)))})).reduce((function(e,t){return[e,", ",t]}));return n.createElement(f.Z.Item,{key:a.join()},s," — ",n.createElement(Ne,null,r))}return n.createElement(Ze,je({key:r,name:r,data:a},o))})))}));Ce.propTypes={className:D().string,currentTime:D().number,setTime:D().func,data:D().object.isRequired},Ce.defaultProps={className:"",currentTime:0,setTime:function(){return null}};var Ze=function(e){var t=e.name,r=e.level,a=Te(e,["name","level"]),o=xe((0,n.useState)(!0),2),l=o[0],i=o[1],c=(0,n.useCallback)((function(){return i(!l)}),[l]),s="glyph fas fa-chevron-".concat(l?"down":"right");return n.createElement(n.Fragment,null,n.createElement(F.Z,{className:"d-flex",action:!0,onClick:c},n.createElement("i",{className:s}),n.createElement("b",null,t)),n.createElement(ke.Z,{in:l},n.createElement(Ce,je({className:"timecodes-nested-".concat(r),level:r+1},a))))};Ze.propTypes={name:D().string.isRequired,level:D().number},Ze.defaultProps={level:0};var _e=r(27977),Ae=r(62318),De=r(29119),Ie=r(87011),Fe=D().shape({segment:D().string,name:D().string,note:D().string,date:D().objectOf(Date),games:D().arrayOf(D().string),streams:D().arrayOf(D().string),official:D().bool,youtube:D().string,direct:D().string,torrent:D().string,thumbnail:D().string,url:D().string,abs_start:D().number,abs_end:D().number,duration:D().number}),Ue=D().shape({name:D().string,start:D().number,segment:D().string,original:Fe,url:D().string}),He=D().shape({id:D().string,name:D().string,category:D().string,streams:D().arrayOf(Ue)});Ue.game=He;var ze=D().shape({id:D().string,name:D().string});function Be(){return Be=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Be.apply(this,arguments)}function Me(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,a=!1,o=void 0;try{for(var l,i=e[Symbol.iterator]();!(n=(l=i.next()).done)&&(r.push(l.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw o}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return qe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qe(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}D().shape({name:D().string,segment:D().string,start:D().number,category:ze,original:He,segments:D().arrayOf(Fe),url:D().string,streams:D().number,date:D().objectOf(Date)});var We={variant:"dark",size:"sm"},Le=function(e){var t=e.game,r=e.currentSegment,a=e.contentKey;return n.createElement(Q,{heightRelativeToParent:"100%",scrollToSelector:".active",contentKey:a},n.createElement(f.Z,{className:"playlist-streams separator-v"},t.streams.map((function(e){return n.createElement(f.Z.Item,{key:e.segment,as:y.rU,to:e.url,action:!0,active:e.original===r,className:"playlist-streams-item"},n.createElement("span",{className:"flex-grow-1"},e.name),n.createElement("span",null,n.createElement(_e.Z,{pill:!0,bg:"dark"},Ie.Z.format(e.original.date,"{dd}.{MM}"),n.createElement("br",null),e.original.date.getFullYear())))}))))};Le.propTypes={game:He.isRequired,currentSegment:Fe.isRequired,contentKey:D().any},Le.defaultProps={contentKey:null};var Ke=function(e){var t=e.open,r=e.children;return n.createElement(ke.Z,{in:t},n.createElement("div",null,n.createElement(De.e,{defaultSize:{height:"30vh"},enable:{bottom:!0}},r)))};Ke.propTypes={open:D().bool.isRequired};var $e=function(e){var t=e.games,r=e.game,a=e.segment,o=e.autoExpand,l=e.fullHeight,i=Me((0,n.useState)(r),2),s=i[0],u=i[1],f=Me((0,n.useState)(o),2),m=f[0],p=f[1],d=t.indexOf(s),y=0!==d&&t[d-1],h=d!==t.length-1&&t[d+1];return n.createElement(n.Fragment,null,n.createElement(Ae.Z,{className:"d-flex flex-row playlist-header separator-h"},n.createElement(c.Z,Be({onClick:function(){return u(y)},disabled:!y},We),n.createElement("i",{className:"fas fa-arrow-left"})),n.createElement(c.Z,Be({onClick:function(){return p(!m)},className:"flex-1-0-0",disabled:l},We),s.name),n.createElement(c.Z,Be({onClick:function(){return u(h)},disabled:!h},We),n.createElement("i",{className:"fas fa-arrow-right"}))),l?n.createElement(Le,{game:s,currentSegment:a}):n.createElement(Ke,{open:m},n.createElement(Le,{game:s,currentSegment:a,contentKey:s.id+m})))};function Ge(e){return Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ge(e)}function Je(){return Je=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Je.apply(this,arguments)}function Ve(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ye(e,t){return Ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ye(e,t)}function Qe(e,t){return!t||"object"!==Ge(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Xe(e){return Xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Xe(e)}$e.propTypes={games:D().arrayOf(He).isRequired,game:He.isRequired,segment:Fe.isRequired,autoExpand:D().bool,fullHeight:D().bool},$e.defaultProps={autoExpand:!1,fullHeight:!1};var et=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ye(e,t)}(i,e);var t,r,a,o,l=(a=i,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Xe(a);if(o){var r=Xe(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Qe(this,e)});function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=l.call(this,e)).ref=n.createRef(),t}return t=i,(r=[{key:"componentDidMount",value:function(){var e=this.props.el,t=this.ref.current;t&&t.appendChild(e)}},{key:"render",value:function(){var e=this.props,t=(e.el,function(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}(e,["el"]));return n.createElement("div",Je({ref:this.ref},t))}}])&&Ve(t.prototype,r),i}(n.PureComponent);et.propTypes={el:D().object.isRequired};var tt=r(7145),rt=r.n(tt);const nt=function(e,t,r){e.setState(rt()(e.state,t),r)};var at=r(93724),ot=r(38966),lt=r(2984),it=r(90677);function ct(){return ct=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ct.apply(this,arguments)}function st(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,a=!1,o=void 0;try{for(var l,i=e[Symbol.iterator]();!(n=(l=i.next()).done)&&(r.push(l.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw o}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ut(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ut(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ut(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var ft={link:"Ссылка",mpv:"Команда MPV"},mt=function(e){var t=e.mode,r=e.onChange;return n.createElement(ot.default,{size:"sm",className:"d-flex mb-0"},Object.entries(ft).map((function(e){var a=st(e,2),o=a[0],l=a[1];return n.createElement(ot.default.Item,{key:o,active:t===o,onClick:function(){return r(o)},className:"flex-1-0-0"},l)})))};mt.propTypes={mode:D().string.isRequired,onChange:D().func.isRequired};var pt=n.forwardRef((function(e,t){var r=e.segment,a=e.currentTime,i=function(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}(e,["segment","currentTime"]),s=(0,n.useRef)(),u=Math.floor(a),f=st((0,n.useState)("link"),2),m=f[0],p=f[1],d=st((0,n.useState)(null),2),y=d[0],h=d[1],v=st((0,n.useState)(u>0),2),b=v[0],E=v[1];if((0,n.useEffect)((function(){g.V.then((function(e){var t=e.segments;return h(t)}))}),[]),!y)return n.createElement(lt.Z,ct({ref:t},i,{className:"share-popover"}),n.createElement(lt.Z.Header,{as:"h3"},"Создать короткую ссылку"),n.createElement(lt.Z.Body,{className:"d-flex justify-content-center"},n.createElement(U.Z,{animation:"border"})));var O,S=st((0,at.wk)(y,r,u),2),w=S[0],k=S[1];switch(m){case"link":O=function(e,t){return"https://drhx.ru/b/"+e.segment+(t?"?at=".concat(t):"")}(b||-1===r.segment.indexOf(".")?w:r,b&&k);break;case"mpv":O=function(e,t){return["mpv",e.subtitles?"--sub-file=".concat(new URL(e.subtitles,window.location.href)):"",0!==e.abs_start?"--sub-delay=".concat(-e.abs_start):"",t?"--start=".concat(t):"",e.end?"--end=".concat(e.end):"",e.youtube?"ytdl://".concat(e.youtube):e.direct].filter((function(e){return e})).join(" ")}(r,b&&u);break;default:O=""}return n.createElement(lt.Z,ct({ref:t},i,{className:"share-popover"}),n.createElement(lt.Z.Header,{as:"h3"},"Создать короткую ссылку"),n.createElement(lt.Z.Body,null,n.createElement(o.Z,null,n.createElement(l.Z,null,n.createElement(Ae.Z,null,n.createElement(it.Z.Control,{ref:s,readOnly:!0,value:O,size:"sm"}),n.createElement(c.Z,{variant:"dark",size:"sm",onClick:function(){var e=s.current;e&&(e.select(),e.setSelectionRange(0,200),document.execCommand("copy"))}},n.createElement("i",{className:"fas fa-copy"}))))),n.createElement(o.Z,{className:"mt-2"},n.createElement(l.Z,{className:"d-flex align-content-center"},n.createElement(it.Z.Check,{className:"me-auto",type:"checkbox",label:"Начать с таймкода: ",checked:b,onChange:function(e){var t=e.target.checked;return E(t)}}),n.createElement(it.Z.Control,{className:"time-selector",value:(0,H.y)(u),size:"sm",readOnly:!0,htmlSize:4}))),n.createElement(o.Z,{className:"mt-2"},n.createElement(l.Z,null,n.createElement(mt,{mode:m,onChange:p})))))}));pt.propTypes={segment:D().object.isRequired,currentTime:D().number.isRequired};var dt=r(72846);function yt(e){return yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yt(e)}function ht(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,a=!1,o=void 0;try{for(var l,i=e[Symbol.iterator]();!(n=(l=i.next()).done)&&(r.push(l.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw o}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return vt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?vt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function bt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function gt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Et(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ot(e,t){return Ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ot(e,t)}function St(e,t){return!t||"object"!==yt(t)&&"function"!=typeof t?wt(e):t}function wt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function kt(e){return kt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},kt(e)}var jt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ot(e,t)}(S,e);var t,r,h,E,O=(h=S,E=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=kt(h);if(E){var r=kt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return St(this,e)});function S(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,S),(t=O.call(this,e)).state=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?bt(Object(r),!0).forEach((function(t){gt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({loaded:!1,fullscreen:!1,segment:null,segmentRef:null,relatedGames:null,timecodes:null,currentTime:0,setTime:null,playlistAccordion:null},_.load("SegmentPlayer",{chatOverlay:{width:null,height:null,x:null,y:null},sidebarCollapsed:!1})),t.toggleSidebar=t.toggleSidebar.bind(wt(t)),t.renderPlayerOverlay=t.renderPlayerOverlay.bind(wt(t)),t.chatContainer=t.createChatContainer(),t}return t=S,r=[{key:"createChatContainer",value:function(){var e=document.createElement("div");return e.style.height="100%",e.style.display="flex",e.style.flexDirection="column",e}},{key:"resolveUrl",value:function(e){var t=e.segments,r=e.games,n=this.props.location.search,a=new URLSearchParams(n),o=a.has("at")?+a.get("at"):null,l=this.props.match.params,i=l.game,c=l.segment,s=ht((0,at.K8)(t,c,o),3),u=s[0],f=s[1],m=s[2];if(!u)return null;var p=u.segment!==c;c=u.segment;var d,y=r.by("id",i);if(y&&-1!==u.games.indexOf(i))d=(0,at.GG)(y,u);else{var h=ht((0,at.PI)(r,u,f),2);y=h[0],d=h[1],i=y.id,p=!0}var v="/play/".concat(i,"/").concat(u.segment);return f&&(v+="?at=".concat(f)),{segment:u,game:y,segmentRef:d,autostart:m,redirect:p&&v}}},{key:"loadData",value:function(){var e=this;g.V.then((function(t){var r=t.segments,n=t.timecodes,a=t.games,o=e.props.history,l=e.resolveUrl({segments:r,games:a});if(l){l.redirect&&o.replace(l.redirect);var i=l.game,c=l.segment,s=l.segmentRef,u=l.autostart,f=c.games.map((function(e){return a.by("id",e)}));0===f.length&&(f=null),e.setState({loaded:!0,segment:c,game:i,segmentRef:s,relatedGames:f,autostart:u,savedPositionAdapter:new P(c)}),n.then((function(t){e.setState({timecodes:t[c.segment]})}))}else o.replace("/404")}))}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"shouldComponentUpdate",value:function(e,t){return _.save("SegmentPlayer",this.state,t,["chatOverlay","sidebarCollapsed"]),!0}},{key:"componentDidUpdate",value:function(e){var t=this.props.match.params,r=e.match.params;(t.segment!==r.segment||t.game!==r.game)&&this.loadData()}},{key:"toggleSidebar",value:function(){var e=this.state.sidebarCollapsed;if(!e){var t=document.body.style.pointerEvents;document.activeElement.blur(),document.body.style.pointerEvents="none",setTimeout((function(){document.body.style.pointerEvents=t}),100)}this.setState({sidebarCollapsed:!e})}},{key:"renderPlayer",value:function(){var e=this,t=this.state,r=t.segmentRef,a=r.start,c=r.end,s=r.force_start,u=t.segment,f={youtube:u.youtube,direct:u.direct,start:a,autostart:t.autostart,end:c,forceStart:s,savedPositionAdapter:t.savedPositionAdapter,onTimeChange:function(t){return e.setState({currentTime:t})},onReady:function(t){e.setState({setTime:function(e){t.currentTime=e,t.play()},toggleFullscreen:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t.fullscreen.forceFallback=e,t.fullscreen.toggle()}})},onFullScreen:function(t){return e.setState({fullscreen:t})},onDestroy:function(){return e.setState({setTime:null,currentTime:0})},renderOverlay:this.renderPlayerOverlay};return n.createElement(o.Z,null,n.createElement(l.Z,null,n.createElement(i.Z,{aspectRatio:"16x9"},n.createElement(we,f))))}},{key:"renderPlayerOverlay",value:function(e){var t=this,r=e.width,a=e.height,o=this.state,l=o.fullscreen,i=o.segment.subtitles,c=o.chatOverlay;return l&&i?n.createElement(b.s,{className:"chat-overlay",position:{x:null!==c.x?c.x*r:0,y:null!==c.y?c.y*a:.65*a},size:{width:c.width?"".concat(100*c.width,"%"):"35%",height:c.height?"".concat(100*c.height,"%"):"35%"},onDragStop:function(e,n){var o=n.x,l=n.y;nt(t,{chatOverlay:{$merge:{x:o/r,y:l/a}}})},onResizeStop:function(e,n,o,l,i){nt(t,{chatOverlay:{$merge:{width:o.offsetWidth/r,height:o.offsetHeight/a,x:i.x/r,y:i.y/a}}})},bounds:"parent"},this.renderChat()):null}},{key:"renderPlayerControls",value:function(){var e=this.state,t=e.toggleFullscreen,r=e.segment,a=e.currentTime,i=r.segment,f=r.youtube,m=r.official,p=r.torrent;return n.createElement(o.Z,{className:"g-0"},n.createElement(l.Z,null,n.createElement("div",{className:"player-controls border-top border-bottom"},n.createElement("div",{className:"label me-2 d-none d-xxl-block"},"Смотреть на:"),!i.startsWith("00")&&n.createElement(c.Z,{variant:"dark",size:"sm",className:"me-2",href:"https://twitch.tv/videos/".concat(i),target:"blank"},n.createElement("i",{className:"fab fa-twitch"}),n.createElement("span",null,"Twitch")),f&&n.createElement(c.Z,{href:"https://youtu.be/".concat(f),target:"blank",variant:"dark",size:"sm",className:"me-2"},n.createElement("i",{className:"fab fa-youtube"}),n.createElement("span",null,"Youtube"),n.createElement(s.Z,{placement:"top",overlay:n.createElement(u.Z,null,!1===m?"Неофициальный канал":"Официальный канал")},!1===m?n.createElement("i",{className:"fas fa-exclamation-circle text-warning"}):n.createElement("i",{className:"fas fa-check-circle text-success"}))),p&&n.createElement(c.Z,{href:p,variant:"dark",size:"sm",className:"me-2"},n.createElement("i",{className:"fas fa-download"}),n.createElement("span",{className:"d-none d-xl-inline"},"Торрент")),n.createElement("div",{className:"flex-grow-1"}),n.createElement(s.Z,{trigger:"click",rootClose:!0,placement:"top",overlay:n.createElement(pt,{segment:r,currentTime:a})},n.createElement(c.Z,{variant:"dark",size:"sm",className:"me-2"},n.createElement("i",{className:"fas fa-share-square"}),n.createElement("span",{className:"d-none d-xl-inline"},"Поделиться"))),n.createElement(s.Z,{placement:"top",overlay:function(e){return n.createElement(u.Z,e,"Оставить в окне только плеер, но не переходить в полноэкранный режим")}},n.createElement(c.Z,{variant:"dark",size:"sm",onClick:function(){return t(!0)},className:"me-2"},n.createElement("i",{className:"fas fa-expand-arrows-alt"}),n.createElement("span",{className:"d-none d-lg-inline"},"На всё окно"))),n.createElement(s.Z,{placement:"top",overlay:function(e){return n.createElement(u.Z,e,"Развернуть плеер на весь экран")}},n.createElement(c.Z,{variant:"dark",size:"sm",onClick:function(){return t(!1)}},n.createElement("i",{className:"fas fa-expand"}),n.createElement("span",{className:"d-none d-lg-inline"},"На весь экран"))))))}},{key:"renderChat",value:function(){var e=this.state,t=e.fullscreen,r=e.currentTime,a=e.segment,o=a.subtitles,l=a.abs_start,i=n.createElement("div",{className:"sidebar-header"},"Чат");return o?n.createElement(n.Fragment,null,!t&&i,n.createElement(me,{currentTime:r,offset:-l,subtitles:o,simple:t})):n.createElement(n.Fragment,null,i,n.createElement("div",{className:"p-4 flex-grow-1 align-self-center text-white"},"Для этого стрима нет записи чата :("))}},{key:"renderTimecodes",value:function(){var e=this.state,t=e.timecodes,r=e.setTime,a=e.currentTime;return n.createElement(n.Fragment,null,n.createElement("div",{className:"sidebar-header"},"Таймкоды"),n.createElement(Q,{flex:"1 1 0"},n.createElement(Ce,{data:t,setTime:r,currentTime:a})))}},{key:"renderPlaylist",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.autoExpand,r=void 0!==t&&t,a=e.fullHeight,o=void 0!==a&&a,l=this.state,i=l.segment,c=l.game,s=l.relatedGames;return s?n.createElement(n.Fragment,null,n.createElement("div",{className:"sidebar-header"},"Плейлист"),n.createElement($e,{games:s,game:c,segment:i,autoExpand:r,fullHeight:o})):null}},{key:"renderLeftSidebar",value:function(){var e=this.state,t=e.sidebarCollapsed,r=e.timecodes,a=e.relatedGames,o=e.segment.subtitles,i=["col-sidebar-narrow border-end",t?"collapsed":""].join(" ");return o?n.createElement(n.Fragment,null,(r||a)&&n.createElement(v(),{minDeviceWidth:1200},n.createElement(l.Z,{className:i,tabIndex:"0"},n.createElement("div",{className:"content"},n.createElement("div",{className:"sidebar-row-overlay flex-row-reverse"},n.createElement(c.Z,{variant:"link",size:"sm",onClick:this.toggleSidebar},t?n.createElement("i",{className:"fas fa-caret-square-right"}):n.createElement("i",{className:"fas fa-caret-square-left"}))),a&&this.renderPlaylist(),r&&this.renderTimecodes()),n.createElement("div",{className:"collapsed-content"},a&&n.createElement("div",{className:"sidebar-header"},"Плейлист"),r&&n.createElement("div",{className:"sidebar-header"},"Таймкоды")))),(r||a)&&n.createElement(v(),{minDeviceWidth:768,maxDeviceWidth:1199},n.createElement(l.Z,{className:"col-sidebar-narrow collapsed",tabIndex:"0"},n.createElement("div",{className:"content border-end"},a&&this.renderPlaylist(),r&&this.renderTimecodes()),n.createElement("div",{className:"collapsed-content"},a&&n.createElement("div",{className:"sidebar-header"},"Плейлист"),r&&n.createElement("div",{className:"sidebar-header"},"Таймкоды"))))):null}},{key:"renderRightSidebar",value:function(){var e=this.chatContainer,t=this.state,r=t.fullscreen,a=t.relatedGames,o=t.timecodes,i=t.segment.subtitles;return i||a||o?n.createElement(v(),{minDeviceWidth:768},n.createElement(l.Z,{className:"col-sidebar-wide border-start"},i&&!r&&n.createElement(et,{el:e,className:"flex-1-1-0"}),!i&&a&&this.renderPlaylist(),!i&&o&&this.renderTimecodes())):null}},{key:"renderDescription",value:function(){var e=this.state,t=e.game,r=e.segment,a=e.segmentRef;return n.createElement(o.Z,{className:"stream-description"},n.createElement(l.Z,null,n.createElement("h3",null,n.createElement(y.rU,{to:"/play/".concat(t.id)},t.name),n.createElement("span",null," — "),n.createElement("span",{className:"flex-grow-1"},a.name)),n.createElement(f.Z,{variant:"flush",size:"sm"},n.createElement(f.Z.Item,null,"Дата стрима:"," ",Ie.Z.medium(r.date)," ","(",Ie.Z.relative(r.date),")"),r.note&&n.createElement(f.Z.Item,{dangerouslySetInnerHTML:{__html:r.note}}))))}},{key:"renderBelowPlayer",value:function(){var e=this,t=this.chatContainer,r=this.state,a=r.fullscreen,i=r.relatedGames,c=r.timecodes,s=r.segment.subtitles;return n.createElement(n.Fragment,null,n.createElement(v(),{minDeviceWidth:768},this.renderDescription()),n.createElement(v(),{maxDeviceWidth:767},n.createElement(v(),{maxDeviceWidth:575},(function(r){return n.createElement(o.Z,{className:"flex-grow-1 flex-shrink-1 g-0"},n.createElement(l.Z,{className:"sidebar-content"},n.createElement(m.Z,{mountOnEnter:!0},n.createElement(p.Z,{eventKey:"description",title:"Описание"},r?e.renderDescription():n.createElement(Q,{flex:"1 1 0"},e.renderDescription())),c&&n.createElement(p.Z,{eventKey:"timecodes",title:"Таймкоды"},e.renderTimecodes()),i&&n.createElement(p.Z,{eventKey:"playlist",title:"Плейлист",unmountOnExit:!0},e.renderPlaylist({autoExpand:!0,fullHeight:!0})),s&&r&&n.createElement(p.Z,{eventKey:"chat",title:"Чат"},!a&&n.createElement(et,{el:t,className:"flex-1-1-0"})))),s&&!r&&n.createElement(l.Z,{className:"sidebar-content border-start"},!a&&n.createElement(et,{el:t,className:"flex-1-1-0"})))}))))}},{key:"render",value:function(){if(!this.state.loaded)return n.createElement(dt.A,{fluid:!0,flex:!0,withFooter:!1,isLoading:!0});var e=this.chatContainer,t=this.state,r=t.segment,i=r.subtitles,c=r.thumbnail,s=r.date,u=t.segmentRef.name,f=t.game.name,m="".concat(u," | ").concat(f);return n.createElement(dt.A,{fluid:!0,flex:!0,withFooter:!1,title:m},n.createElement(d.ql,null,n.createElement("meta",{property:"og:description",content:"Запись стрима от ".concat(Ie.Z.medium(s))}),c.startsWith("http")&&n.createElement("meta",{property:"og:image",content:c})),i&&a.createPortal(this.renderChat(),e),n.createElement(o.Z,{className:"flex-grow-1 g-0"},this.renderLeftSidebar(),n.createElement(l.Z,{className:"d-flex flex-column"},this.renderPlayer()," ",this.renderPlayerControls(),this.renderBelowPlayer()),this.renderRightSidebar()))}}],r&&Et(t.prototype,r),S}(n.Component)}}]);